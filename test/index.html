<!DOCTYPE html>
<meta charset="utf-8">
<html>
  <head>
  <title>COW tests</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <link href='http://fonts.googleapis.com/css?family=Dosis:300,500' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript" src="../lib/underscore/underscore-min.js" type="text/javascript"></script>
  <script type="text/javascript" src="../lib/polyfill-promise/promise-0.1.1.min.js" type="text/javascript"></script>
  
  <script type="text/javascript" src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <!-- IndexedDB -->
  <script type="text/javascript" src="../lib/IndexedDBShim/IndexedDBShim.min.js"></script>
  <script type="text/javascript" src="../lib/dbjs/db.js"></script>
  
  <script type="text/javascript" src="../src/cow2.utils.js"></script>
  <script type="text/javascript" src="../src/cow2.record.js"></script>
  <script type="text/javascript" src="../src/cow2.syncstore.js"></script>
  <script type="text/javascript" src="../src/cow2.peer.js"></script>
  <script type="text/javascript" src="../src/cow2.socketserver.js"></script>
  <script type="text/javascript" src="../src/cow2.user.js"></script>
  <script type="text/javascript" src="../src/cow2.group.js"></script>
  <script type="text/javascript" src="../src/cow2.item.js"></script>
  <script type="text/javascript" src="../src/cow2.project.js"></script>
  <script type="text/javascript" src="../src/cow2.websocket.js"></script>
  <script type="text/javascript" src="../src/cow2.core.js"></script>
  <script type="text/javascript" src="../src/cow2.js"></script>
  <script type="text/javascript" src="../test/cow.testsuite.js"></script>
  <style>
  </style>
  </head>
  <body>
   <button onclick="clearlog()">Clear</button>
   <button onclick="tests.analyzeStore()">Analyze</button>
   <button onclick="tests.pingtest()">Pingtest</button>
   <button onclick="tests.lifecycle()">Lifecycle</button>
   <button onclick="tests.socketservers()">Socketservers</button>
   <div id='socketservers'>
   </div>
   <div id="console"></div>
   
  
  <script type="text/javascript">
  
  var core = new Cow.core();
  //add a default socketserver
  core.socketservers({
    _id:'wss://websocket.geodan.nl:443/', 
    data: {url:'wss://websocket.geodan.nl:443/'}
  });
  
  function reload_serverlist(){
      var serverlist = _.filter(core.socketservers(), function(d){return !d.deleted()});
          var servers = d3.select('#socketservers').selectAll('div')
            .data(serverlist, function(d){return d.id();});
          servers.enter().append('div')
            .html(function(d){return d.id();})
            .on('click', function(d){
                    var ws = core.websocket();
                    ws.disconnect();
                    ws.connect(d.data('url'));
            });
          servers.exit().remove();
  }
  
  var connection = core.connect('wss://websocket.geodan.nl:443/');
  core.socketserverStore().loaded.then(reload_serverlist);
  core.socketserverStore().on('datachange', reload_serverlist);
  var tests = new Cow.testsuite(core);
  
  //tests.analyzeStore();
  //tests.lifecycle();
  
  
  </script>
  </body>
  </html>
