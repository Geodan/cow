<!DOCTYPE html>
<meta charset="utf-8">
<html>
  <head>
  <title>Concurrent Online Webgis</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes">
  
  <!-- Fancy google font -->
  <link href='http://fonts.googleapis.com/css?family=Dosis:300,500' rel='stylesheet' type='text/css'>
  
  <!-- JQuery part -->
  <link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" />
  <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
  <script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>  
  <script src="../lib/jquery.indexeddb/jquery.indexeddb.min.js" type="text/javascript"></script>
  
  <!-- Openlayers part -->
  <script src="http://openlayers.org/api/OpenLayers.js" type="text/javascript"></script>
  <!--DEBUG <script src="/libs/OpenLayers/lib/OpenLayers.js" type="text/javascript"></script>-->

  <script src="/libs/d3js/d3.v3.min.js" charset="utf-8"></script>
  
  <link rel="stylesheet" href="css/style.mobile-jq.css" />
  <link rel="stylesheet" type="text/css" href="css/cow.css" />
  
  <script src="../src/cow.core.js" type="text/javascript"></script>
  <script src="../src/cow.websocket.js" type="text/javascript"></script>
  <script src="../src/cow.peer.js" type="text/javascript"></script>
  <script src="../src/cow.herd.js" type="text/javascript"></script>
  <script src="../src/cow.featurestore.js" type="text/javascript"></script>
  <script src="../src/cow.localdbase.js" type="text/javascript"></script>
  <script src="../src/cow.geolocator.js" type="text/javascript"></script>
  
  <script src="scripts/d3layer.js" type="text/javascript"></script>
  <script src="scripts/olmapwidget.js" type="text/javascript"></script>
  <script src="scripts/peerwidget.js" type="text/javascript"></script>
  <script src="scripts/featurewidget.js" type="text/javascript"></script>
  <script src="scripts/newfeaturewidget.js" type="text/javascript"></script>
  <script src="scripts/connectwidget.js" type="text/javascript"></script>
  <script src="scripts/helpwidget.js" type="text/javascript"></script>

<script type="text/javascript">

function WebSocketTest()
{
  if ("WebSocket" in window)
  {
   
    
  }
  else
  {
    alert("Sorry, your browser doesn't support websockets, so this site doesn't do anything magical");
  }
}
WebSocketTest();
var UID = 0;
var myname = "Anonymous";
var myproject = "demo";
          
var geojson_format = new OpenLayers.Format.GeoJSON({
    'internalProjection': new OpenLayers.Projection("EPSG:900913"),
    'externalProjection': new OpenLayers.Projection("EPSG:4326")
   });
var core;

function launchFullscreen(element) {
  if(element.requestFullScreen) {
    element.requestFullScreen();
  } else if(element.mozRequestFullScreen) {
    element.mozRequestFullScreen();
  } else if(element.webkitRequestFullScreen) {
    element.webkitRequestFullScreen();
  }
}

var resizeContentArea = function() {
    var content, contentHeight, footer, header, viewportHeight;
    window.scroll(0, 0);
    header = $(":jqmData(role='header'):visible");
    footer = $(":jqmData(role='footer'):visible");
    content = $(":jqmData(role='content'):visible");
    viewportHeight = $(window).height();
    contentHeight = viewportHeight - header.outerHeight() - footer.outerHeight();
    $("article:jqmData(role='content')").first().height(contentHeight);
    return $("#map").height(contentHeight);
};

function init(){
    $("#toggletop").click(function() {
        if ($('#top').css('display') == 'block') {
            var height = '-=' + $('#top').height();
        } else {
            var height = '+=' + $('#top').height();
        }
        $("#top").slideToggle("slow");
        $("#content").animate({
            top: height
        }, "slow")
    });


  $('.ui-mobile [data-role="page"]').css("position", "relative"); 
  $('.ui-mobile [data-role="dialog"]').css("position", "relative");
  $('.ui-page').css("position", "relative");
  $(window).bind('orientationchange pageshow resize', resizeContentArea);
}

$( document ).on( "pageinit", "#mappage", function() {
    init();
});
$(document).ready(function(){
  $('#cow').cow({
    websocket: {url: 'wss://websocket.geodan.nl:443/'}
  });
  core =$('#cow').data('cow');
  $('#map').OlMapWidget({core: '#cow'});
  $('#connect').ConnectWidget({core: '#cow'});
  //$('#help').HelpWidget({core: '#cow'});
  $('#peers').PeersWidget({core: '#cow',name:'#myname'});
  //$('#features').FeaturesWidget({core: '#cow'});
  $('#newfeatpanel').NewFeatureWidget({core: '#cow'});
  
  
});

</script>
  </head>
  <body>
  <div data-role="page" id="mappage" data-theme="d" onClick="launchFullscreen(document.documentElement)">
      <div data-role="header" data-theme="b" id="header">
      <div data-role="navbar">
          <ul>
                <li><a href="#newfeatpanel" data-theme="d" data-icon="arrow-r" data-iconpos="left">Draw</a></li>
                <li><a href="#" data-theme="d" id="toggletop">Status</a></li>
                <li><a href="#peers" data-theme="d" data-icon="arrow-l" data-iconpos="right">Peers</a></li>
            </ul>
        </div><!-- /navbar -->
        
      </div><!-- /header -->
  
      <div data-role="content">
      <div id="top">
            
            <span id="connect" title="click to change connection status"></span>
            <!--<span class="copyright">design/code <a href='http://creativecommons.org/licenses/by/3.0/'>CC-BY</a>/<a href="http://opensource.org/licenses/BSD-2-Clause">BSD</a> by <a href="http://research.geodan.nl">Geodan Research</a></span>
            -->
              <span class="welcome">
                    <input data-mini="true" id="myname"/ name="myname" title="click to change your name" value="anonymous" size="13"/>
               </span>
               <span class="header_right">
              Welcome
              </span>
        </div><!-- /top -->
      
        <div id="map" class="map"></div>
      </div><!-- /content -->
  
      <div data-role="panel" id="newfeatpanel" data-theme="b">
      </div> <!-- /left-panel -->
  
      <div data-role="panel" id="peers" data-display="push" data-position="right" data-theme="c">
      </div>
  </div>
    <div id="cow"></div>	
    <div id="help" ></div>
  </body>
</html>


