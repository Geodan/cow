<!DOCTYPE html>
<meta charset="utf-8">
<html>
  <head>
  <title>Concurrent Online Webgis</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    
<!--  <link href='http://code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css' rel='stylesheet' type='text/css'>
-->  <link href='http://fonts.googleapis.com/css?family=Dosis:300,500' rel='stylesheet' type='text/css'>
  
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>	
  <script src="http://code.jquery.com/ui/1.10.2/jquery-ui.js" type="text/javascript"></script>  
  <script src="../lib/jquery.indexeddb/jquery.indexeddb.min.js" type="text/javascript"></script>
  
  <script src="http://openlayers.org/api/OpenLayers.js" type="text/javascript"></script>    
  <script src="http://maps.stamen.com/js/tile.stamen.js?v1.1.3"></script>

  <!-- Adding leaflet and D3 libs, possible replacement for OL -->
<!--
  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6/leaflet.css" />
  <link rel="stylesheet" href="../lib/leaflet_draw/leaflet.draw.css" />
  <link rel="stylesheet" href="../lib/leaflet_label/leaflet.label.css" />
 -->

  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script src="http://d3js.org/topojson.v1.min.js"></script>

  <!--[if lte IE 8]>
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6/leaflet.ie.css" />
  <![endif]-->
<!--
  <script src="http://cdn.leafletjs.com/leaflet-0.6/leaflet.js"></script>
  <script src="../lib/leaflet_draw/leaflet.draw.js"></script>
  <script src="../lib/leaflet_label/leaflet.label.js"></script>
-->
  <script src="scripts/nodeoverlay.js" type="text/javascript"></script>
  <script src="scripts/d3layer.js" type="text/javascript"></script>
  
  <!-- Peerjs -->
  <script type="text/javascript" src="../lib/peer.js"></script>
  
  <link rel="stylesheet" type="text/css" href="css/cow.css" />	
  <link rel="stylesheet" type="text/css" media="screen" href="css/screen.css" />

  
  <script src="../src/cow.core.js" type="text/javascript"></script>
  <script src="../src/cow.websocket.js" type="text/javascript"></script>
  <script src="../src/cow.peer.js" type="text/javascript"></script>
  <script src="../src/cow.herd.js" type="text/javascript"></script>
  <script src="../src/cow.featurestore.js" type="text/javascript"></script>
  <script src="../src/cow.localdbase.js" type="text/javascript"></script>
  <script src="../src/cow.geolocator.js" type="text/javascript"></script>
  <!--
  <script src="scripts/jquery.i18n.properties-min-1.0.9.js" type="text/javascript"></script>
  -->
  <script src="scripts/i18next-1.7.1/i18next-1.7.1.min.js" type="text/javascript"></script>
  <script src="scripts/translator.js" type="text/javascript"></script>
  <!--<script src="scripts/leaflmapwidget.js" type="text/javascript"></script>-->
  <script src="scripts/olmapwidget.js" type="text/javascript"></script>
  <script src="scripts/peerwidget.js" type="text/javascript"></script>
  <script src="scripts/featurewidget.js" type="text/javascript"></script>
  <script src="scripts/newfeaturewidget.js" type="text/javascript"></script>
  <script src="scripts/connectwidget.js" type="text/javascript"></script>
  <script src="scripts/helpwidget.js" type="text/javascript"></script>
  <script src="scripts/layout.js" type="text/javascript"></script>
  <script src="scripts/cookies.js" type="text/javascript"></script>

<script type="text/javascript">

function WebSocketTest()
{
  if ("WebSocket" in window)
  {
   
    
  }
  else
  {
    alert("Sorry, your browser doesn't support websockets, so this site doesn't do anything magical");
  }
}
WebSocketTest();

var core;

var transcallback = function(){
      //Translate some static texts
      $('#myname').attr('title',translator.translate('txt_clicktochangename'));
      $('#connect').attr('title', translator.translate('txt_clicktoconnect'));
      $('#txt_welcome').html(translator.translate('txt_welcome'));
      $('#maptitle').html(translator.translate('maptitle'));
      $('#addfeattitle').html(translator.translate('addfeattitle'));
      $('#deletedfeats').html(translator.translate('deletedfeats'));
      $('#peerstitle').html(translator.translate('peerstitle'));
  }
translator.loadBundles({
    callback: transcallback,
    path: 'lang/',
    lang: 'nl'
});

$(document).ready(function(){
  
  $('#cow').cow({
    websocket: {url: 'wss://websocket.geodan.nl:443/'}
    //websocket: {url: 'wss://websocket.geodan.nl:443/geofort'}
  });
  
  core =$('#cow').data('cow');
  
  $('#map').OlMapWidget({core: '#cow'});
  $('#connect').ConnectWidget({core: '#cow'});
  $('#help').HelpWidget({core: '#cow'});
  $('#peers').PeersWidget({core: '#cow',name:'#myname'});
  $('#features').FeaturesWidget({core: '#cow'});
  $('#newfeatpanel').NewFeatureWidget({core: '#cow'});
  
  //TODO: move username admin to other place
  //Some username administration with cookies
  var username=getCookie("username");
  if (username!=null && username!="")
  {
    core.username(username);
  }
  else 
  {
  username=prompt("Please enter your name:","");
  if (username!=null && username!="")
    {
        core.username(username);
        setCookie("username",username,1);
    }
  }
  //What to do when a user changes name
  $('#myname').on('blur', function(e, ui) {
    var username = $(this).val();
    core.me().owner({name:username});
    setCookie("username",username,1);
  });
});
 

</script>
  </head>
  <body>	 
  <div id="top">
    <span id="connect" title="click to change connection status"></span>
    <span class="copyright">design/code <a href='http://creativecommons.org/licenses/by/3.0/'>CC-BY</a>/<a href="http://opensource.org/licenses/BSD-2-Clause">BSD</a> by <a href="http://research.geodan.nl">Geodan Research</a></span>
    <span class="welcome"><span id="txt_welcome">Welcome</span> <input id="myname"/ name="myname" title="click to change your name" value="anonymous" size="13"/></span>
  </div>
  <div id="content">
  <div id="col-map" class="column big">
    <div class="col-content">
      <div class="title"><div class="titel" id="maptitle">Map</div></div>
      <div class="col-body">
        <div id="map" class="map"></div>
      </div>
    </div>
  </div>
    <div id="col-newfeature" class="column small o1st">
    <div class="col-content">
      <div class="title"><div class="titel" id="addfeattitle">Add&nbsp;a&nbsp;feature</div></div>
      <div class="col-body">
        <div id="newfeatpanel"></div>
      </div>
    </div>
  </div>	

  
  <div id="col-feature" class="column hidden o2nd">
    <div class="col-content">		
      <div class="title"><div class="titel" id="deletedfeats">Deleted&nbsp;features</div></div>
      <div class="col-body">
        <div id="features"></div>
      </div>
    </div>
  </div>
  <div id="col-peer" class="column hidden o3rd">
    <div class="col-content">
      <div class="title"><div class="titel" id="peerstitle">Peers</div></div>
      <div class="col-body">
        <div id="peers">
        </div>
      </div>
    </div>
  </div> 

  </div>
  <div id="cow"></div>	
  <div id="help" ></div>
  </body>
</html>


